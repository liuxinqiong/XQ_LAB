## 数据埋点与上报思考
关于埋点与上报的思考

入口信息：打开该页面的前一个页面是什么就能得到用户的入口信息，该信息可以由 document.referrer 得到

用户兴趣点：从代码角度而言，用户点击过的按钮都是用户感兴趣，需要统计用户点击了什么按钮，该信息可以通过点击事件获取

用户特征：客户端信息，比如用户所用浏览器信息，设备信息，该信息可以由 navigator.userAgent 以及获取设备宽高等信息获取，甚至可以统计访问的时间段

前端优化：页面响应时间

其他：用户停留时间

上报方式
* ajax发送：跨域问题，兼容性问题
* jsonp发送：能跨域，兼容性好，需要后台配合
* img发送：本质和jsonp一样，点位信息发送，不需要返回信息，无论成功与否都不需要处理，比jsonp方便之处在于，js创建img标签之后，设置其src值就会直接发送请求，不需要将img标签append到页面，而script标签则不行

如何埋点
* 给每个需要埋点手动加上click事件，自动其实很好实现，给每个需要埋点的标签加上某个属性，然后通过js选择所有包含该属性的标签进行事件绑定
* 给body加上click事件，通过事件委托来做，考虑到如果埋点过多，对事件绑定则过多，可能影响的性能。当用户点击时，获取其目标标签，然后进行递归查询父节点是否含有该私有属性，如果有则发送其属性值给后端，当然，为了性能考虑，所以递归结束条件除了body节点意外在额外加一个step条件，向上递归3-5层以内。

为了解决前端埋点的准确性、及时性、开发效率等问题，业内各家公司从不同角度，提出了多种技术方案，这些方案大体上可以归为三类：
* 第一类是代码埋点，即在需要埋点的节点调用接口直接上传埋点数据，友盟、百度统计等第三方数据统计服务商大都采用这种方案；
* 第二类是可视化埋点，即通过可视化工具配置采集节点，在前端自动解析配置并上报埋点数据，从而实现所谓的“无痕埋点”，代表方案是已经开源的Mixpanel；
* 第三类是“无埋点”，它并不是真正的不需要埋点，而是前端自动采集全部事件并上报埋点数据，在后端数据计算时过滤出有用数据，代表方案是国内的GrowingIO。

通用信息：MAC地址，IMEI，系统版本号、应用版本号、网络状态、GPS地址、触发时间、用户ID

访问时长：window 的 onbeforeunload，针对单页应用，则在路由中进行处理

### 关键字
单页、beforeEach、多页、点击、pv

## 参考
* [说说前端那些事——数据埋点](https://blog.csdn.net/stopllL/article/details/78856214)